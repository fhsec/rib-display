<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Screenshot Rotator</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
            background-color: #000;
        }
        
        #image-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .screenshot {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            object-fit: cover; /* Changed from 'contain' to 'cover' to stretch/fill screen */
        }
        
        .active {
            opacity: 1;
        }
        
        #station-info {
            position: absolute;
            bottom: 10px;
            right: 10px;
            color: rgba(255, 255, 255, 0.5);
            font-family: Arial, sans-serif;
            font-size: 14px;
            padding: 5px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 3px;
            opacity: 0.5;
            z-index: 10; /* Ensure it's above the images */
        }
        
        #error-message {
            color: white;
            font-family: Arial, sans-serif;
            font-size: 24px;
            text-align: center;
            margin: 20% auto;
        }
        
        /* Added styles for fitting options */
        .fit-options {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
            opacity: 0.3;
            transition: opacity 0.3s;
        }
        
        .fit-options:hover {
            opacity: 1;
        }
        
        .fit-button {
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 5px 10px;
            margin-left: 5px;
            cursor: pointer;
            border-radius: 3px;
        }
        
        .fit-button.active {
            background-color: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <div id="image-container">
        <!-- Images will be inserted here by JavaScript -->
    </div>
    <div id="station-info"></div>
    
    <!-- Added fit options controls -->
    <div class="fit-options">
        <button class="fit-button" id="btn-cover">Fill</button>
        <button class="fit-button" id="btn-contain">Fit</button>
    </div>

    <script>
        // List of valid stations
        const validStations = [
            '234-1000', 
            '234-1100', 
            '234-1200', 
            '234-1300', 
            '234-1400', 
            '234-2000'
        ];
        
        // Function to get URL parameters
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            const results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }
        
        // Get station from URL parameter, default to first station if not specified or invalid
        let station = getUrlParameter('station') || validStations[0];
        
        // Get fitting mode from URL parameter, default to 'cover' (stretch to fill)
        let fitMode = getUrlParameter('fit') || 'cover';
        
        // Validate station
        if (!validStations.includes(station)) {
            station = validStations[0];
        }
        
        // Validate fit mode
        if (!['cover', 'contain'].includes(fitMode)) {
            fitMode = 'cover';
        }
        
        // Base path for images
        const basePath = 'images/' + station + '/';
        
        // Display station info
        document.getElementById('station-info').textContent = 'Station: ' + station;
        
        // Update fit mode buttons
        document.getElementById('btn-cover').classList.toggle('active', fitMode === 'cover');
        document.getElementById('btn-contain').classList.toggle('active', fitMode === 'contain');
        
        // Add event listeners to fit mode buttons
        document.getElementById('btn-cover').addEventListener('click', () => {
            setFitMode('cover');
        });
        
        document.getElementById('btn-contain').addEventListener('click', () => {
            setFitMode('contain');
        });
        
        // Function to set fitting mode
        function setFitMode(mode) {
            fitMode = mode;
            
            // Update buttons
            document.getElementById('btn-cover').classList.toggle('active', mode === 'cover');
            document.getElementById('btn-contain').classList.toggle('active', mode === 'contain');
            
            // Update all screenshots
            document.querySelectorAll('.screenshot').forEach(img => {
                img.style.objectFit = mode;
            });
            
            // Update URL parameter without reloading
            const url = new URL(window.location);
            url.searchParams.set('fit', mode);
            window.history.pushState({}, '', url);
        }
        
        // Define maximum number of screenshots to try loading
        const maxScreenshots = 10; // Try up to 10 screenshots
        
        // Initialize variables
        let currentIndex = 0;
        const container = document.getElementById('image-container');
        let loadedImages = 0;
        let hasError = false;
        const loadedScreenshots = []; // Array to store successfully loaded screenshots
        
        // Create image elements 
        function createImageElements() {
            // Clear container first
            container.innerHTML = '';
            
            let loadingPromises = [];
            
            // Try to load screenshots with both PNG and JPG extensions
            for (let i = 1; i <= maxScreenshots; i++) {
                // Try PNG first
                loadingPromises.push(tryLoadImage(`screenshot${i}.png`, i));
                
                // Also try JPG
                loadingPromises.push(tryLoadImage(`screenshot${i}.jpg`, i));
            }
            
            // After all attempts are complete, check if we loaded any images
            Promise.all(loadingPromises).then(() => {
                if (loadedScreenshots.length === 0) {
                    hasError = true;
                    showError(`No images found for station ${station}.`);
                } else {
                    // Sort the loaded screenshots by their index
                    loadedScreenshots.sort((a, b) => a.index - b.index);
                    
                    // Add all loaded screenshots to the container
                    loadedScreenshots.forEach((screenshot, idx) => {
                        // Apply current fit mode
                        screenshot.element.style.objectFit = fitMode;
                        
                        container.appendChild(screenshot.element);
                        if (idx === 0) {
                            screenshot.element.classList.add('active');
                        }
                    });
                }
            });
        }
        
        // Try to load an image and return a promise
        function tryLoadImage(filename, index) {
            return new Promise(resolve => {
                const img = document.createElement('img');
                img.className = 'screenshot';
                img.alt = `Screenshot ${index}`;
                img.style.objectFit = fitMode; // Apply fit mode
                
                // Resolve the promise whether the image loads or not
                img.onload = function() {
                    // Add to our collection of loaded screenshots
                    // Only add if we don't already have this index (avoid duplicates if both PNG and JPG exist)
                    if (!loadedScreenshots.some(s => s.index === index)) {
                        loadedScreenshots.push({
                            index: index,
                            element: img
                        });
                    }
                    resolve();
                };
                
                img.onerror = function() {
                    // Image failed to load - that's ok, we'll try other formats or indices
                    resolve();
                };
                
                // Set the source to trigger loading
                img.src = basePath + filename;
            });
        }
        
        // Show error message
        function showError(message) {
            container.innerHTML = `<div id="error-message">${message}</div>`;
        }
        
        // Rotate images
        function rotateImages() {
            if (hasError || loadedScreenshots.length === 0) return;
            
            // Hide current image
            loadedScreenshots[currentIndex].element.classList.remove('active');
            
            // Update index to next image
            currentIndex = (currentIndex + 1) % loadedScreenshots.length;
            
            // Show next image
            loadedScreenshots[currentIndex].element.classList.add('active');
        }
        
        // Auto-hide controls after inactivity
        let activityTimeout;
        function resetActivityTimeout() {
            clearTimeout(activityTimeout);
            document.querySelector('.fit-options').style.display = 'block';
            
            activityTimeout = setTimeout(() => {
                document.querySelector('.fit-options').style.display = 'none';
            }, 5000); // Hide after 5 seconds of inactivity
        }
        
        // Track mouse movement to show/hide controls
        document.addEventListener('mousemove', resetActivityTimeout);
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            createImageElements();
            
            // Set rotation interval (20 seconds)
            setInterval(rotateImages, 20000);
            
            // Initially hide controls after a delay
            resetActivityTimeout();
        });
        
        // Add keyboard controls for manual navigation (optional)
        document.addEventListener('keydown', (event) => {
            if (hasError || loadedScreenshots.length === 0) return;
            
            if (event.key === 'ArrowRight') {
                // Hide current image
                loadedScreenshots[currentIndex].element.classList.remove('active');
                
                // Update index to next image
                currentIndex = (currentIndex + 1) % loadedScreenshots.length;
                
                // Show next image
                loadedScreenshots[currentIndex].element.classList.add('active');
                
                // Reset activity timeout
                resetActivityTimeout();
            } else if (event.key === 'ArrowLeft') {
                // Hide current image
                loadedScreenshots[currentIndex].element.classList.remove('active');
                
                // Update index to previous image
                currentIndex = (currentIndex - 1 + loadedScreenshots.length) % loadedScreenshots.length;
                
                // Show next image
                loadedScreenshots[currentIndex].element.classList.add('active');
                
                // Reset activity timeout
                resetActivityTimeout();
            } else if (event.key === 'f') {
                // Toggle between fit modes
                setFitMode(fitMode === 'cover' ? 'contain' : 'cover');
                
                // Reset activity timeout
                resetActivityTimeout();
            }
        });
    </script>
</body>
</html>
